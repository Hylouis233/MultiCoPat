# MultiCoPat

**ime-Frequency Dynamics of Influenza Co-circulation based on STL-AFD-CWT-WTC**

[English](README.md) | [简体中文](README_CN.md)

## 摘要

**目的**：多种流感病毒亚型的共流行对全球公共卫生监测和预测构成了重大挑战。尽管流感传播的时空异质性已有记录，但病毒共流行对疫情非平稳序列的具体影响仍知之甚少。本研究旨在通过时频分析，揭示共流行对流感传播系统及其与环境驱动因子的耦合关系。

**方法**：本研究整合季节-趋势分解（STL）、自适应傅里叶分解（AFD）、连续小波变换（CWT）及小波相干性（WTC）的分析框架。对中国2011年至2025年间的323个周级流感监测时间序列进行分析，并定量评估了63,308对流感-环境变量的时频耦合强度。

**结果**：研究发现，共流行期与单一主导期具有根本不同的动态机制，且共流行期存在着流感系统从有序向混沌的机制转换。在共流行期间，季节性频率漂移显著增加，残差项中涌现出高强度的异常波动。此外，本研究还从数据的维度揭示了显著的南北方机制差异：北方地区表现出"环境锁定"，即便在共流行期，疫情仍受严酷气候的强力约束；而南方地区则呈现"环境解耦"，特别是在H3N2共流行期间，病毒间的生态竞争超越了环境驱动力（如湿度、温度），导致传统环境预测因子的失效。

**结论**：本研究结果证明流感共流行期的独特时频状态，流感共流行并非简单的毒株叠加，而是引发流感传播系统的改变。表明公共卫生策略需具备情境适应性，北方地区可继续依赖气象预警，而在南方共流行期间，应降低对环境指标的依赖，转而加强实时的病原学与血清学监测。

![框架图](figures/figure1_framework.pdf)
*图 1: 分析框架 (STL-AFD-CWT-WTC)*

## 主要发现

1.  **从有序到混沌的机制转换**:
    *   共流行期与单一主导期具有根本不同的动态机制。
    *   在共流行期间，流感系统经历了一次机制转换，其特征是 **季节性漂移** 显著增加，且残差分量中涌现出高强度的异常波动。

    ![STL 动力学对比](figures/figure3_stl_comparison.pdf)
    *图 3: 单一主导期与共流行期的 STL 动力学对比。注意共流行期间残差波动的显著增加。*

2.  **时空异质性 (Spatiotemporal Heterogeneity)**:
    *   **中国北方环境锁定**: 即便在共流行期，疫情仍受严酷气候条件的强力约束。
    *   **中国南方环境解耦**: 病毒间的生态竞争往往超越了环境驱动力（如湿度和温度）。这在 H3N2 共流行期间尤为明显，导致传统环境预测因子的失效。

    ![综合统计分析](figures/figure6_integrated_stats.pdf)
    *图 6: 综合统计分析显示中国南北方存在显著不同的模式。*

3.  **公共卫生启示 (Implications for Public Health)**:
    *   防控策略需要具备情境适应性。
    *   **北方**: 继续依赖气象预警。
    *   **南方**: 在共流行期间，应降低对环境指标的依赖，转而加强实时的病原学与血清学监测。

## 方法论：四步分析框架

1.  **STL 分解**: 从原始时间序列中隔离宏观趋势 ($T_t$) 和稳定的季节性 ($S_t$)。
2.  **自适应傅里叶分解 (AFD)**: 从高频残差 ($R_t$) 中提取具有物理意义的瞬态分量，以捕捉非线性动力学。
3.  **连续小波变换 (CWT)**: 揭示病毒传播的时频指纹和亚型竞争的瞬态特征。
4.  **小波相干性 (WTC)**: 定量评估流感传播与环境驱动因子之间的动态耦合关系。

## 仓库结构

- `src/`: 实现方法论的核心分析脚本。
  - `data_portal.py`: 用于加载和预处理数据的统一接口。
  - `stl_decomposition.py`: 第 1 步 - 季节-趋势分解。
  - `AFD_analysis.py`: 第 2 步 - 自适应傅里叶分解。
  - `cwt_analysis.py`: 第 3 步 - 连续小波变换。
  - `wtc_analysis.py`: 第 4 步 - 小波相干性分析。
  - `comprehensive_analysis.py`: 综合统计分析与模式识别。

- `figures/`: 用于复现论文中图表的脚本。
  - `plot_figure*.py`: 特定图表的绘图脚本（例如：图 3 STL 动力学对比）。
  - `utils.py`: 通用的绘图工具函数。

- `robustness/`: 敏感性分析脚本。
  - `robustness_runner.py`: 稳健性实验的主驱动程序（基准、保守、敏感、消融场景）。

- `data/`: 输入数据和处理结果的存放目录。

## 安装

1. 克隆仓库:
   ```bash
   git clone https://github.com/Hylouis233/MultiCoPat.git
   cd MultiCoPat
   ```

2. 安装依赖:
   ```bash
   pip install -r requirements.txt
   ```

## 使用方法

### 1. 数据准备
将您的原始数据放置在 `data/` 目录下。

### 2. 运行分析流程
按顺序执行核心分析脚本：
```bash
python src/stl_decomposition.py
python src/AFD_analysis.py
# ... 依此类推
```

### 3. 复现图表
生成图表（例如：图 3）：
```bash
python figures/plot_figure3_stl_comparison.py
```
输出结果将保存在 `results/figures/` 目录下。

### 4. 运行稳健性检验
```bash
python robustness/robustness_runner.py
```
